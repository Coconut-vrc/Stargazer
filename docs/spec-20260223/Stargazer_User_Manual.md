# Stargazer 管理者用完全マスタリング・マニュアル (v2.3)

本ドキュメントは、イベント運営者が Stargazer を「最短かつ完璧に」使いこなし、事故のない抽選・マッチング環境を構築するための究極のガイドブックです。

---

## 1. はじめに：Stargazer の全体フロー

Stargazer は以下の 5 ステップで運用が完結します。

1. **データ準備**: Google フォーム等の回答を TSV で出力。
2. **インポート**: アプリにデータを読み込み、列を割り当てる。
3. **当日準備**: キャストの出席状況を確認し、NG リストを微調整。
4. **抽選実行**: 当選者を選出し、招待枠（確定枠）を固定。
5. **マッチング**: マッチングロジックを選定し、結果をエクスポート。

---

## 2. 実践：データのインポート手順

### 2.1 理想的な TSV の構成
インポートをスムーズにするため、以下のヘッダー名で列を用意することを推奨します。
- `名前` または `ユーザー名`
- `X ID` または `Twitter ID`
- `第一希望`, `第二希望`, `第三希望` (キャスト名を正確に入力)

### 2.2 列マッピングの極意
「データ読取」画面でファイルを選択すると、自動で列の割り当てが行われます。
> [!IMPORTANT]
> **「希望キャスト」列が複数ある場合**:
> 割り当て画面で、すべての希望キャスト列を「キャスト」としてマークしてください。これにより、マッチングロジックが優先順位を正しく認識します。

### 2.3 テンプレート機能の活用
一度マッピングして「取り込む」をクリックすると、そのヘッダー形式が自動保存されます。次回同じフォームから出力したファイルを取り込む際、マッピング作業は 0 秒で完了します。

---

## 3. キャスト・NG・要注意人物の管理

運営の安全性（キャストのメンタル・安全保護）を守るための最も重要なセクションです。

### 3.1 キャストの出欠確認 (重要)
イベント開始 30 分前には必ず「キャスト管理」画面を確認してください。
- 出席しているキャストのトグルを **オン (緑色)** にします。
- **欠席キャストをオフにし忘れると**: そのキャストにユーザーが割り当てられ、現場で混乱が生じます。

### 3.2 判定基準の選択
「設定」→「NG管理」から判定の厳しさを選べます。
- **名前で判定**: 同姓同名の別人（または名前を頻繁に変えるユーザー）がいる場合に注意。
- **X IDで判定**: 最も確実な方法です。
- **両方で判定 (推奨)**: どちらかがヒットすれば警告を出す安全策です。

### 3.3 要注意人物の検知
データベース画面で名前の横に **⚠️ (オレンジ)** が表示されているユーザーは、現在出席している「2人以上のキャスト」から個別に NG 指定を受けている人物です。
- 運営の判断で、抽選前にそのユーザーを削除、もしくは「確定落選」として扱うことを検討してください。

---

## 4. 抽選 (Lottery) のプロテクニック

### 4.1 確定枠（招待枠）の扱い
すでに当選が確約されているスポンサーや招待客がいる場合：
1. 「抽選条件」画面で「確定当選者を選択」をクリック。
2. 該当ユーザーにチェックを入れます。
3. **人数計算のルール**: 「当選者数 10人 ＋ 確定枠 2人 ＝ 合計 12人」となります。

### 4.2 抽選テンプレートの保存
「通常営業用」「多対多イベント用」など、よく使う人数設定をテンプレートとして名前を付けて保存できます。

---

## 5. マッチングモードの選び方とコツ

イベントの性質に合わせて、最適なロジックを選択してください。

### 5.1 M001: 完全ランダム・希望優先
- **特徴**: 希望キャスト (1st-3rd) を考慮しつつ、残りをランダムに埋めます。
- **用途**: 「誰に当たるか分からないワクワク感」を重視する交流会。
- **注意**: 希望が偏ると、希望が全く通らないユーザーが一定数発生します。

### 5.2 M002: 循環ローテーション (全員巡回)
- **特徴**: 全員が全キャストと順番に面談・会話します。
- **用途**: 1対1の回転寿司形式の面談イベント。
- **制限**: ユーザー数とキャスト数が一致している（またはユーザー数が少ない）場合に最適です。

### 5.3 M003: 複数対複数マルチ巡回
- **特徴**: 3対3など、テーブル単位でキャストが移動します。
- **用途**: キャストがコンビ/ユニットで接客する場合。
- **コツ**: 「総テーブル数」をキャストのユニット数以上にしておくことで、待機キャストが発生せずに済みます。

---

## 6. 詳細機能：Discord URL 自動補完

キャストの連絡先登録（Discord サーバー等）の手間を省く隠し機能です。

| 入力キーワード | 変換後の結果 |
| :--- | :--- |
| `dscsv@12345` | `https://discord.com/channels/12345` |
| `dscdm@12345` | `https://discord.com/channels/@me/12345` |

これを活用することで、モバイル端末等からの煩雑な URL コピー＆ペーストが不要になります。

---

## 7. トラブルシューティング 徹底解説

### 7.1 「抽選結果とマッチング結果が矛盾している」
- **原因**: 抽選後にキャストの出欠を変更した場合に発生します。
- **対策**: キャストの出欠を変更した後は、必ず「マッチング開始」を再度クリックして再計算を行ってください。

### 7.2 「NG回避不可」というエラーが出る
- **原因**: 循環モード (M002) において、どのタイミングで回っても NG ユーザーと遭遇してしまう組み合わせが発生した。
- **対策**: 
    1. NG 設定を一時的に「除外」から「警告のみ」に変更する。
    2. キャストの出席人数を 1 人増やして巡回サイクルをずらす。

### 7.3 出力した TSV が文字化けする
- **原因**: Excel が UTF-8 エンコーディングを正しく認識していない。
- **対策**: Excel で「データ」→「テキストから」を選択し、文字コードに `65001: Unicode (UTF-8)` を指定して取り込んでください。

---

## 8. データのメンテナンスと安全なバックアップ

### 8.1 データの保存場所
Stargazer は以下の場所にすべてのデータを保存しています。
- `%LOCALAPPDATA%\CosmoArtsStore\Stargazer`

### 8.2 手動バックアップの推奨
大きなイベントの前には、上記のフォルダごと USB メモリやクラウドストレージへコピーしておくことを強く推奨します。もし PC が故障しても、別 PC にこのフォルダを移すだけで運営を続行できます。

--- (End of Manual) ---
